# Лабораторная работа №3

### Алгоритм работы с графами (моделирование транспортной системы)
                                                                                        Выполнил студент:       Шаймуханов Тимур
                                                                                                          4 курс, z34434, 2023 г
---
## Цель 

&ensp; Познакомить студента с инструментами, направленными на решение задач, использующих
графовые модели.

## Задание

&ensp; Моделирование сложных транспортных процессов города, выявление узких участков, а также
формирование предложений по оптимизации.

&ensp; На изображении отображены перекрестки, которые рассматривать для решения задачи.
В качестве агентов (автомобилей) и маршрутов их перемещения использовать придуманные
данные, отраженные в отчете по лабораторной работе (предусмотреть часы пик утром и
вечером).

### Задача 1

&ensp; Необходимо определить TOP-10 самых загруженных участков
между перекрестками, а также время на «рассасывание» этого затора.
Отображать такие параметры, как:

- количество агентов (автомобилей) на участке;

- процент загруженности участка;

- длительность высокой загруженности (более 90%).

### Задача 2
&ensp; С помощью сформированной модели предложить варианты
решения заторов.

## Решение

### Допущения и структура модели

#### Время и часы пик

Время модели исчисляется в условых единицах (назовем их тактами), соответствующих циклам светофоров. Светофоры смоделированы так: за один цикл 'зеленого' через перекресток может проехать не более 15 машин с каждой улицы. Всего симуляция длится 100 тактов. Часы пик приходятся на промежутки [10..20] ('утренний') и [60..70] ('вечерний'). В час пик за один такт генерируется 150 автомобилей, в остальное время -- 50.

#### Модель города

![My Image](https://github.com/timur-shaymuhanov/algorithms/blob/1840b46d183c1fc6cfaa868307f42c92d6d4c514/lab_03/doc/city_graph.jpg)


Город описывается классом Model(nx.DiGraph), который наследует направленному графу из библиотеки NetworkX. Мы строим его 'по модели Манхеттена', то есть используя ```nx.2d_grid_graph()``` и затем случайным образом задавая направления улиц. В этом графе вершины соответствуют перекресткам, а ребра -- улицам.

У каждой улицы есть параметр 'max_load' -- максимальное количество машин, которые на ней помещаются и динамически вычисляемый на каждом шаге симуляции параметр 'current_load' -- загруженность улицы в данный момент. 'max_load' взят равным 100 для всех улиц, таким образом количество машин на улице и ее загруженность -- одно и то же.

На каждом шаге симуляции генерируется 'gen_num_step' автомобилей. Каждый автомобиль является экземпляром класса Car. Конструктор принимает в качестве аргумента граф города и генерирует случайный путь фиксированной максимальной длины по этому графу. Автомобиль хранит информацию о своем пути и положении в данный момент. После генерации новых машин происходит обработка движения с учетом ограничений: автомобиль остается на том же месте, если следующая улица по маршруту забита (ее 'current_load' = 100), либо если 'загорелся красный' (то есть через перекресток проехало максимально допустимое количество автомобилей).

При переходе через перекресток, значения 'current_load' старой и новой улиц меняются на единицу соответствующим образом, а также обновляется положение данной машины. Все машины хранятся в списке Model.cars, при достижении точки назначения машина из этого списка стирается.

'current_load' является основной метрикой задачи.

#### Допущения ПДД
Для упрощения модели и конкретизации задачи был сделан ряд допущений:

1. Светофоры имеют всего два сигнала: красный и зелёный.

2. На любом перекрёстке можно выбрать любое из 4 возможных направлений

3. Машины выезжают и паркуются мгновенно.

#### Оптимизация

Для решения проблемы заторов ('current_load' >= 90%) выбран теоретико-игровой механизм оптимизации. Каждый водитель является игроком, у которого есть 2 стратегии: ехать на машине или воспользоваться общественным транспортом (например, метро). Базовая стратегия -- ехать на машине, но на каждой итерации модели у каждого водителя есть возможность изменить свое решение (пересесть на метро). Это реализовано так: если на улице затор, все водители мгновенно паркуются и пересаживаются на метро, их машины удаляются из модели. 


### Выбор структуры данных и алгоритма

Для решения задачи использовалось 2 класса: для хранения и обновления модели города и для хранения информации об одном автомобиле. Модель города построена на основе NetworkX.DiGraph. 

Оценим вычислительную сложность алгоритма при каждом обновлении модели: пусть у нас есть $N$ улиц, на данный момент в системе $M$ автомобилей, генерируется еще $m$ новых с максимальной длиной пути $L$.

Что происходит:
 
 - Генерируем $m$ новых машин, для каждой из которых строим случайный путь длины $\ell \leq L$ - $O(m \cdot L)$ 
 - Для каждой улицы 'меняем сигнал светофора на зеленый' (обнуляем соответствующий параметр) - $O(N)$
 - Далее для каждой машины (при возможности) меняем положение - $O(M)$

   Итого получаем сложность $O(N + M + m \cdot L)$

## Вывод
&ensp; Я познакомился с приримерами решения задач по алгоритмам на графах, соответсвующими структурами данных и созданием моделей оптимизации.
